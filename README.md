# Reproducibility Package â€“ Language Models as Architectural Gatekeepers

This repository contains all datasets, scripts, and supplementary material associated with the paper:

> **Language Models as Architectural Gatekeepers: Automating Conformance Checking from Natural Language**  
> *Andrielly Lucena, Everton L. G. Alves, JoÃ£o Brunet*  
> *Accepted at the Brazilian Symposium on Software Engineering (SBES 2025)*

---

## Abstract

Ensuring architectural conformance is a key challenge in software engineering. This work explores the use of Large Language Models (LLMs) to generate **design conformance tests** directly from **natural language design rules**, typically expressed in development discussions (e.g., code reviews, issues). Our approach avoids the need for formal architecture specifications by leveraging informal communication and transforming it into executable design tests using the [Design Wizard](https://github.com/joaoarthurbm/designwizard) library.

---

## Repository Structure

```

.
â”œâ”€â”€ codebase/                     # Java code (DesignPatterns) used in evaluation
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ doc/                      # HTML documentation from Design Wizard used in RAG
â”‚   â”œâ”€â”€ rules.csv                 # Rules + context used in test generation
â”‚   â”œâ”€â”€ generated-design-tests/  # Java code generated by LLM for each rule
â”œâ”€â”€ designwizard/                # .jar of the Design Wizard library
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ constants.py             # Utility file with shared constants
â”‚   â”œâ”€â”€ rule\_generator.py        # Script to generate realistic natural language rules using GPT
â”‚   â”œâ”€â”€ vector\_creation.py       # Loads documentation into PostgreSQL for RAG
â”‚   â”œâ”€â”€ query.py                 # Main test generator: queries the doc + generates test from rule
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md

````

---

## Running the Pipeline

### 1. Set up PostgreSQL with pgvector

You must be running a PostgreSQL database with `pgvector` support. To start a container with the required setup:

```bash
docker run --name pgvector-db \
  -e POSTGRES_PASSWORD=mysecretpassword \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_DB=designwizard_docs \
  -p 5432:5432 \
  -d pgvector/pgvector:pg16
````

Make sure to configure your `.env` or environment variables to match the credentials used above.

---

### 2. Ingest Design Wizard documentation

The documentation used for the RAG pipeline is located in `data/doc/`. To store it in the database as vector embeddings, run:

```bash
python scripts/vector_creation.py
```

---

### 3. Generate Natural Language Rules

To generate natural language rules from examples of real-world discussions:

```bash
python scripts/rule_generator.py
```

This uses GPT to produce realistic architectural design rules. The resulting rules are saved in `data/rules.csv`.

---

### 4. Generate Design Tests

The `query.py` script performs the test generation. It:

* Loads the rule from `data/rules.csv`
* Retrieves relevant documentation from the database
* Adds code context (e.g., class names and structure)
* Sends a prompt to the LLM to generate a design conformance test

Run with:

```bash
python scripts/query.py
```

The generated test code will be saved in `data/generated-design-tests/`.

---

## Evaluation Setup

We used the [DesignPatterns](https://github.com/clarck/DesignPatterns) repository to validate generated tests.

### Java Code Compilation & Execution

1. Navigate into a specific design pattern folder inside `codebase/`.
2. Compile with:

```bash
javac -d bin -cp "lib/junit-4.13.2.jar;lib/hamcrest-core-1.3.jar;lib/designwizard-1.4.jar;." src/test/*.java src/com/cnblog/clarck/*.java
```

3. Execute with:

```bash
java -cp "lib/junit-4.13.2.jar;lib/hamcrest-core-1.3.jar;lib/designwizard-1.4.jar;bin;." org.junit.runner.JUnitCore test.DesignTest
```

---

## Contact

**Andrielly Lucena**
Federal University of Campina Grande (UFCG), Brazil
ðŸ“§ [andriellylucena@copin.ufcg.edu.br](mailto:andriellylucena@copin.ufcg.edu.br)
